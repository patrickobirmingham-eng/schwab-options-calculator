<!DOCTYPE html>
<html>
<head>
    <title>Quick Schwab Quote</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .box { border: 1px solid #ccc; padding: 20px; border-radius: 10px; max-width: 400px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #0070f3; color: white; border: none; cursor: pointer; }
        #status { font-size: 0.8em; color: gray; }
    </style>
</head>
<body>

<div class="box">
    <h3>1. Connect</h3>
    <button onclick="login()">Login to Schwab</button>
    <p id="status">Status: Not Connected</p>

    <h3>2. Get Price</h3>
    <input type="text" id="sym" placeholder="NVDA 03/06/2026 185.00 P">
    <button onclick="getQuote()">Get Quote</button>
    
    <div id="out" style="margin-top:10px; font-weight:bold;"></div>
</div>

<script>
    // These come from your Schwab Dashboard
    const clientID = 'MbUXOJWErKFjQXLrF268rvG4l6yYwDSuRveQ1qtAYT4hbkCA';
    const redirect = 'https://patrickobirmingham-eng.github.io/schwab-options-calculator/';

    function login() {
        window.location.href = `https://api.schwabapi.com/v1/oauth/authorize?client_id=${clientID}&redirect_uri=${redirect}`;
    }

    // Check if we just returned from login
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    if (code) {
        document.getElementById('status').innerText = "Status: Connected! (Code received)";
        // Note: In a real app, we'd exchange this code for a token here.
    }

    async function getQuote() {
        const input = document.getElementById('sym').value;
        document.getElementById('out').innerText = "Fetching " + input + "...";
        
        // This is where we call your Vercel proxy
        try {
            const res = await fetch(`/api/getQuote?symbol=${encodeURIComponent(input)}`);
            const data = await res.json();
            document.getElementById('out').innerText = `Bid: $${data.bid} | Ask: $${data.ask}`;
        } catch (e) {
            document.getElementById('out').innerText = "Error: Check if login expired.";
        }
    }
</script>
</body>
</html>
